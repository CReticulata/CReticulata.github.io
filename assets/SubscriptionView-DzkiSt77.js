import{r as h,c as o,h as b,a4 as Z,u as H,g as J,a as X,a5 as ee,ay as p,a9 as te,G as ae,s as B,f as le,a2 as se,_ as E,N as q,M as _,R as d,Z as r,ah as U,S as T,U as F,$ as N,af as ue,W as ne,V as re,L as Q,Y as w,az as oe,a0 as V,O as L,P as ie,Q as ce}from"./index-C_coo_Ez.js";import{u as de,a as ve,o as $,B as fe,k as me,Q as ge,l as be,m as pe}from"./QDialog-DaHVk6da.js";import{Q as _e}from"./QSpinnerTail-CWxXsp9E.js";function he(l,n){const e=h(null),s=o(()=>l.disable===!0?null:b("span",{ref:e,class:"no-outline",tabindex:-1}));function a(u){const i=n.value;u!==void 0&&u.type.indexOf("key")===0?i!==null&&document.activeElement!==i&&i.contains(document.activeElement)===!0&&i.focus():e.value!==null&&(u===void 0||i!==null&&i.contains(u.target)===!0)&&e.value.focus()}return{refocusTargetEl:s,refocusTarget:a}}const Se={xs:30,sm:35,md:40,lg:50,xl:60},Ve={...H,...Z,...de,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:l=>l==="tf"||l==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},ke=["update:modelValue"];function xe(l,n){const{props:e,slots:s,emit:a,proxy:u}=J(),{$q:i}=u,k=X(e,i),x=h(null),{refocusTargetEl:y,refocusTarget:m}=he(e,x),c=ee(e,Se),v=o(()=>e.val!==void 0&&Array.isArray(e.modelValue)),S=o(()=>{const t=p(e.val);return v.value===!0?e.modelValue.findIndex(g=>p(g)===t):-1}),f=o(()=>v.value===!0?S.value!==-1:p(e.modelValue)===p(e.trueValue)),I=o(()=>v.value===!0?S.value===-1:p(e.modelValue)===p(e.falseValue)),P=o(()=>f.value===!1&&I.value===!1),O=o(()=>e.disable===!0?-1:e.tabindex||0),D=o(()=>`q-${l} cursor-pointer no-outline row inline no-wrap items-center`+(e.disable===!0?" disabled":"")+(k.value===!0?` q-${l}--dark`:"")+(e.dense===!0?` q-${l}--dense`:"")+(e.leftLabel===!0?" reverse":"")),R=o(()=>{const t=f.value===!0?"truthy":I.value===!0?"falsy":"indet",g=e.color!==void 0&&(e.keepColor===!0||f.value===!0)?` text-${e.color}`:"";return`q-${l}__inner relative-position non-selectable q-${l}__inner--${t}${g}`}),j=o(()=>{const t={type:"checkbox"};return e.name!==void 0&&Object.assign(t,{".checked":f.value,"^checked":f.value===!0?"checked":void 0,name:e.name,value:v.value===!0?e.val:e.trueValue}),t}),A=ve(j),G=o(()=>{const t={tabindex:O.value,role:"switch","aria-label":e.label,"aria-checked":P.value===!0?"mixed":f.value===!0?"true":"false"};return e.disable===!0&&(t["aria-disabled"]="true"),t});function C(t){t!==void 0&&(B(t),m(t)),e.disable!==!0&&a("update:modelValue",K(),t)}function K(){if(v.value===!0){if(f.value===!0){const t=e.modelValue.slice();return t.splice(S.value,1),t}return e.modelValue.concat([e.val])}if(f.value===!0){if(e.toggleOrder!=="ft"||e.toggleIndeterminate===!1)return e.falseValue}else if(I.value===!0){if(e.toggleOrder==="ft"||e.toggleIndeterminate===!1)return e.trueValue}else return e.toggleOrder!=="ft"?e.trueValue:e.falseValue;return e.indeterminateValue}function M(t){(t.keyCode===13||t.keyCode===32)&&B(t)}function W(t){(t.keyCode===13||t.keyCode===32)&&C(t)}const Y=n(f,P);return Object.assign(u,{toggle:C}),()=>{const t=Y();e.disable!==!0&&A(t,"unshift",` q-${l}__native absolute q-ma-none q-pa-none`);const g=[b("div",{class:R.value,style:c.value,"aria-hidden":"true"},t)];y.value!==null&&g.push(y.value);const z=e.label!==void 0?te(s.default,[e.label]):ae(s.default);return z!==void 0&&g.push(b("div",{class:`q-${l}__label q-anchor--skip`},z)),b("div",{ref:x,class:D.value,...G.value,onClick:C,onKeydown:M,onKeyup:W},g)}}const ye=le({name:"QToggle",props:{...Ve,icon:String,iconColor:String},emits:ke,setup(l){function n(e,s){const a=o(()=>(e.value===!0?l.checkedIcon:s.value===!0?l.indeterminateIcon:l.uncheckedIcon)||l.icon),u=o(()=>e.value===!0?l.iconColor:null);return()=>[b("div",{class:"q-toggle__track"}),b("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},a.value!==void 0?[b(se,{name:a.value,color:u.value})]:void 0)]}return xe("toggle",n)}}),Ie={__name:"Subscription",props:{user:{type:String,required:!0}},emits:["remove:user"],setup(l,{emit:n}){const e=n;return(s,a)=>(_(),q(ue,{class:"subscription"},{default:d(()=>[r(U,null,{default:d(()=>[r($,null,{default:d(()=>[T(F(l.user),1)]),_:1})]),_:1}),r(U,{side:""},{default:d(()=>[r(N,{round:"",unelevated:"",color:"red",icon:"remove",size:"sm",padding:"3px",onClick:a[0]||(a[0]=u=>e("remove:user",l.user))})]),_:1})]),_:1}))}},Ce=E(Ie,[["__scopeId","data-v-43359bcd"]]),Qe={class:"container column items-center"},we={class:"subscriptions"},qe={class:"row justify-center"},Te={key:1,class:"text-grey-8"},$e={class:"text-h6"},Pe={__name:"SubscriptionView",setup(l){const n=ne(),e=re(),s=h(""),a=h(!1),u=h(""),i=h(!0);setTimeout(()=>{i.value=!1},5e3);async function k(){if(n.targetUserEmails.includes(s.value)){u.value="已經訂閱過囉",a.value=!0,s.value="",setTimeout(()=>{a.value=!1},2e3);return}if(s.value===e.user.email){u.value="不能訂閱自己",a.value=!0,s.value="",setTimeout(()=>{a.value=!1},2e3);return}e.isSynchronize=!0;const m=await n.subscribe(s.value);if(m.message==="User not existed"){u.value="找不到使用者",a.value=!0,s.value="",setTimeout(()=>{a.value=!1},2e3);return}if(m.message==="Private user"){u.value="無法訂閱此使用者",a.value=!0,s.value="",setTimeout(()=>{a.value=!1},2e3);return}u.value="訂閱成功",a.value=!0,s.value="",await e.getDataFromGoogleSheet(),e.isSynchronize=!1,a.value=!1}async function x(m){e.isSynchronize=!0,await n.unsubscribe(m),u.value="訂閱已取消",a.value=!0,await e.getDataFromGoogleSheet(),e.isSynchronize=!1,a.value=!1}function y(){e.changePrivacy(),e.user.isPublic=!e.user.isPublic}return(m,c)=>(_(),Q("div",Qe,[r(fe,{class:"subscribe",onSubmit:k},{default:d(()=>[r(ge,{class:"subscribe__input",placeholder:"輸入 email 以訂閱筆記",color:"green",modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=v=>s.value=v)},{append:d(()=>[r(N,{round:"",dense:"",flat:"",icon:"add",onClick:k})]),_:1},8,["modelValue"])]),_:1}),w("div",we,[r(oe,null,{default:d(()=>[r($,{header:""},{default:d(()=>c[3]||(c[3]=[T("帳號隱私")])),_:1}),r(ye,{modelValue:V(e).user.isPublic,"onUpdate:modelValue":y,label:V(e).user.isPublic?"公開":"私人","right-label":"",color:"light-green"},null,8,["modelValue","label"]),r($,{header:""},{default:d(()=>c[4]||(c[4]=[T("目前訂閱")])),_:1}),w("div",qe,[i.value&&V(n).targetUserList.length===0?(_(),q(_e,{key:0,color:"brown",size:"2em"})):L("",!0),!i.value&&V(n).targetUserList.length===0?(_(),Q("div",Te," 還沒有訂閱喔！ ")):L("",!0)]),(_(!0),Q(ie,null,ce(V(n).targetUserEmails,(v,S)=>(_(),q(Ce,{key:S,user:v,"onRemove:user":c[1]||(c[1]=f=>x(f))},null,8,["user"]))),128))]),_:1})]),r(me,{modelValue:a.value,"onUpdate:modelValue":c[2]||(c[2]=v=>a.value=v)},{default:d(()=>[r(be,null,{default:d(()=>[r(pe,{class:"row items-center"},{default:d(()=>[w("div",$e,F(u.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Le=E(Pe,[["__scopeId","data-v-32b7a487"]]);export{Le as default};
