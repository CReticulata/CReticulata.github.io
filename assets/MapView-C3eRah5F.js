import{Q as k,a as v,N as B,b as N,c as _,d as b,C as x}from"./Note-xKSzEpr0.js";import{_ as D,j as q,r as p,t as W,v as E,k as P,m as n,l as c,w as s,o as R,Q as C,x as V,y as S}from"./index-DRNp9sem.js";const z={__name:"MapView",setup(O){const l=q(),r=p({user:l.user.ID,id:"",storeName:"",foodScore:0,serviceScore:0,pros:"",cons:"",location:{lat:0,lng:0},googlemapURL:"",address:""}),u=p(!1),m=p(!1),f=p(!1);let i,d;async function w(){const a=l.userLocation,{Map:o}=await google.maps.importLibrary("maps"),{AdvancedMarkerElement:e}=await google.maps.importLibrary("marker");i=new o(document.getElementById("map"),{zoom:18,center:a,mapId:"DEMO_MAP_ID"}),new e({map:i,position:a,title:"目前位置"}),i.addListener("click",t=>{t.placeId&&M(t.placeId,i)})}async function M(a,o){const{Place:e}=await google.maps.importLibrary("places"),t=new e({id:a,requestedLanguage:"zh_Hant"});await t.fetchFields({fields:["formattedAddress","googleMapsURI","location","displayName"]}),console.log(t),I(a,t.displayName,{lat:t.location.lat(),lng:t.location.lng()},t.googleMapsURI,t.formattedAddress),y(t.location,o,t.displayName,t.formattedAddress)}async function y(a,o,e,t){const{InfoWindow:g}=await google.maps.importLibrary("maps");d=new g({position:a,content:Q(e,t),maxWidth:250}),d.open(o),google.maps.event.addListener(d,"domready",function(){const L=document.querySelector(".create-note");L&&L.addEventListener("click",()=>{if(l.notes.find(A=>A.id===r.value.id)){m.value=!0;return}if(!l.user.ID){f.value=!0;return}u.value=!0})})}function Q(a,o){return`
    <div class="info-window">
      <h6>${a}</h6>
      <p>${o}</p>
      <div class=info-window__button>
        <button class="create-note">新增筆記</button>
      </div>
    </div>`}l.userLocation&&w(),W(()=>l.userLocation,()=>{w()}),E(async()=>{const a=document.querySelector(".search-input input");await google.maps.importLibrary("places");const o=new google.maps.places.Autocomplete(a,{fields:["place_id","geometry","formatted_address","name","url"]});o.addListener("place_changed",()=>{d&&d.close();const e=o.getPlace();console.log(e),!(!e.geometry||!e.geometry.location)&&(e.geometry.viewport?i.fitBounds(e.geometry.viewport):(i.setCenter(e.geometry.location),i.setZoom(18)),I(e.place_id,e.name,{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},e.url,e.formatted_address),y(e.geometry.location,i,e.name,e.formatted_address))})});function U(a){d.close(),u.value=!1;const o=a;if(r.value={user:l.user.ID,id:"",storeName:"",foodScore:0,serviceScore:0,pros:"",cons:"",location:{lat:0,lng:0},googlemapURL:"",address:""},l.notes.find(e=>e.id===o.id)){m.value=!0;return}l.createNote(o)}function I(a,o,e,t,g){r.value.id=a,r.value.storeName=o,r.value.location=e,r.value.googlemapURL=t,r.value.address=g}return(a,o)=>(R(),P("div",null,[n(k,{class:"search-input",outlined:"",placeholder:"在這裡搜尋",color:"red"}),o[6]||(o[6]=c("div",{class:"separator row flex-center"},[c("div",{class:"text text-grey-7 q-py-sm"},"或直接點選地點")],-1)),o[7]||(o[7]=c("div",{id:"map"},null,-1)),n(v,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=e=>u.value=e),persistent:""},{default:s(()=>[n(B,{isCreate:!0,"onUpdate:isCreate":o[0]||(o[0]=e=>u.value=e),noteInput:r.value,"onCreate:note":U},null,8,["noteInput"])]),_:1},8,["modelValue"]),n(v,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=e=>m.value=e)},{default:s(()=>[n(N,null,{default:s(()=>[n(_,{class:"row items-center"},{default:s(()=>[n(C,{name:"warning",color:"negative",size:"24px"}),o[4]||(o[4]=c("span",{class:"q-ml-sm"},"已經寫過這家店的筆記囉！",-1))]),_:1}),n(b,{align:"right"},{default:s(()=>[V(n(S,{flat:"",label:"OK",color:"primary"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(v,{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=e=>f.value=e)},{default:s(()=>[n(N,{style:{width:"200px"}},{default:s(()=>[n(_,{class:"row items-center"},{default:s(()=>[n(C,{name:"warning",color:"negative",size:"24px"}),o[5]||(o[5]=c("span",{class:"q-ml-sm"},"請先登入！",-1))]),_:1}),n(b,{align:"right"},{default:s(()=>[V(n(S,{flat:"",label:"OK",color:"primary"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},$=D(z,[["__scopeId","data-v-63dcd47d"]]);export{$ as default};
