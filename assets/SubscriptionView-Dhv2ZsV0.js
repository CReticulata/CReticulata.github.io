import{r as S,c as i,h as b,a8 as Z,u as H,g as J,a as X,a9 as ee,aA as p,ac as te,G as ae,s as z,f as le,a1 as se,_ as L,N as w,M as _,R as d,Z as o,a4 as U,S as T,U as E,a0 as N,a3 as ue,W as ne,V as re,L as Q,Y as q,$ as h,O as F,P as oe,Q as ie,a6 as ce}from"./index-CC9-M3vu.js";import{u as de,a as ve,k as $,Q as fe,B as me,m as ge,n as be,l as pe}from"./QDialog-DLu1kmRT.js";import{Q as _e}from"./QSpinnerTail-BlAqOXhu.js";function Se(l,n){const e=S(null),u=i(()=>l.disable===!0?null:b("span",{ref:e,class:"no-outline",tabindex:-1}));function a(s){const r=n.value;(s==null?void 0:s.qAvoidFocus)!==!0&&((s==null?void 0:s.type.indexOf("key"))===0?document.activeElement!==r&&(r==null?void 0:r.contains(document.activeElement))===!0&&r.focus():e.value!==null&&(s===void 0||(r==null?void 0:r.contains(s.target))===!0)&&e.value.focus())}return{refocusTargetEl:u,refocusTarget:a}}const Ve={xs:30,sm:35,md:40,lg:50,xl:60},he={...H,...Z,...de,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:l=>l==="tf"||l==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},ke=["update:modelValue"];function xe(l,n){const{props:e,slots:u,emit:a,proxy:s}=J(),{$q:r}=s,k=X(e,r),x=S(null),{refocusTargetEl:y,refocusTarget:m}=Se(e,x),c=ee(e,Ve),v=i(()=>e.val!==void 0&&Array.isArray(e.modelValue)),V=i(()=>{const t=p(e.val);return v.value===!0?e.modelValue.findIndex(g=>p(g)===t):-1}),f=i(()=>v.value===!0?V.value!==-1:p(e.modelValue)===p(e.trueValue)),I=i(()=>v.value===!0?V.value===-1:p(e.modelValue)===p(e.falseValue)),P=i(()=>f.value===!1&&I.value===!1),O=i(()=>e.disable===!0?-1:e.tabindex||0),A=i(()=>`q-${l} cursor-pointer no-outline row inline no-wrap items-center`+(e.disable===!0?" disabled":"")+(k.value===!0?` q-${l}--dark`:"")+(e.dense===!0?` q-${l}--dense`:"")+(e.leftLabel===!0?" reverse":"")),D=i(()=>{const t=f.value===!0?"truthy":I.value===!0?"falsy":"indet",g=e.color!==void 0&&(e.keepColor===!0||f.value===!0)?` text-${e.color}`:"";return`q-${l}__inner relative-position non-selectable q-${l}__inner--${t}${g}`}),R=i(()=>{const t={type:"checkbox"};return e.name!==void 0&&Object.assign(t,{".checked":f.value,"^checked":f.value===!0?"checked":void 0,name:e.name,value:v.value===!0?e.val:e.trueValue}),t}),j=ve(R),G=i(()=>{const t={tabindex:O.value,role:"switch","aria-label":e.label,"aria-checked":P.value===!0?"mixed":f.value===!0?"true":"false"};return e.disable===!0&&(t["aria-disabled"]="true"),t});function C(t){t!==void 0&&(z(t),m(t)),e.disable!==!0&&a("update:modelValue",K(),t)}function K(){if(v.value===!0){if(f.value===!0){const t=e.modelValue.slice();return t.splice(V.value,1),t}return e.modelValue.concat([e.val])}if(f.value===!0){if(e.toggleOrder!=="ft"||e.toggleIndeterminate===!1)return e.falseValue}else if(I.value===!0){if(e.toggleOrder==="ft"||e.toggleIndeterminate===!1)return e.trueValue}else return e.toggleOrder!=="ft"?e.trueValue:e.falseValue;return e.indeterminateValue}function M(t){(t.keyCode===13||t.keyCode===32)&&z(t)}function W(t){(t.keyCode===13||t.keyCode===32)&&C(t)}const Y=n(f,P);return Object.assign(s,{toggle:C}),()=>{const t=Y();e.disable!==!0&&j(t,"unshift",` q-${l}__native absolute q-ma-none q-pa-none`);const g=[b("div",{class:D.value,style:c.value,"aria-hidden":"true"},t)];y.value!==null&&g.push(y.value);const B=e.label!==void 0?te(u.default,[e.label]):ae(u.default);return B!==void 0&&g.push(b("div",{class:`q-${l}__label q-anchor--skip`},B)),b("div",{ref:x,class:A.value,...G.value,onClick:C,onKeydown:M,onKeyup:W},g)}}const ye=le({name:"QToggle",props:{...he,icon:String,iconColor:String},emits:ke,setup(l){function n(e,u){const a=i(()=>(e.value===!0?l.checkedIcon:u.value===!0?l.indeterminateIcon:l.uncheckedIcon)||l.icon),s=i(()=>e.value===!0?l.iconColor:null);return()=>[b("div",{class:"q-toggle__track"}),b("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},a.value!==void 0?[b(se,{name:a.value,color:s.value})]:void 0)]}return xe("toggle",n)}}),Ie={__name:"Subscription",props:{user:{type:String,required:!0}},emits:["remove:user"],setup(l,{emit:n}){const e=n;return(u,a)=>(_(),w(ue,{class:"subscription"},{default:d(()=>[o(U,null,{default:d(()=>[o($,null,{default:d(()=>[T(E(l.user),1)]),_:1})]),_:1}),o(U,{side:""},{default:d(()=>[o(N,{round:"",unelevated:"",color:"red",icon:"remove",size:"sm",padding:"3px",onClick:a[0]||(a[0]=s=>e("remove:user",l.user))})]),_:1})]),_:1}))}},Ce=L(Ie,[["__scopeId","data-v-43359bcd"]]),Qe={class:"container column items-center"},qe={class:"subscriptions"},we={class:"row justify-center"},Te={key:1,class:"text-grey-8"},$e={class:"text-h6"},Pe={__name:"SubscriptionView",setup(l){const n=ne(),e=re(),u=S(""),a=S(!1),s=S(""),r=S(!0);setTimeout(()=>{r.value=!1},5e3);async function k(){if(n.targetUserEmails.includes(u.value)){s.value="已經訂閱過囉",a.value=!0,u.value="",setTimeout(()=>{a.value=!1},2e3);return}if(u.value===e.user.email){s.value="不能訂閱自己",a.value=!0,u.value="",setTimeout(()=>{a.value=!1},2e3);return}e.isSynchronize=!0;const m=await n.subscribe(u.value);if(m.message==="User not existed"){s.value="找不到使用者",a.value=!0,u.value="",setTimeout(()=>{a.value=!1},2e3);return}if(m.message==="Private user"){s.value="無法訂閱此使用者",a.value=!0,u.value="",setTimeout(()=>{a.value=!1},2e3);return}s.value="訂閱成功",a.value=!0,u.value="",await e.getDataFromGoogleSheet(),e.isSynchronize=!1,a.value=!1}async function x(m){e.isSynchronize=!0,await n.unsubscribe(m),s.value="訂閱已取消",a.value=!0,await e.getDataFromGoogleSheet(),e.isSynchronize=!1,a.value=!1}function y(){e.changePrivacy(),e.user.isPublic=!e.user.isPublic}return(m,c)=>(_(),Q("div",Qe,[o(me,{class:"subscribe",onSubmit:k},{default:d(()=>[o(fe,{class:"subscribe__input",placeholder:"輸入 email 以訂閱筆記",color:"green",modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=v=>u.value=v)},{append:d(()=>[o(N,{round:"",dense:"",flat:"",icon:"add",onClick:k})]),_:1},8,["modelValue"])]),_:1}),q("div",qe,[o(ce,null,{default:d(()=>[o($,{header:""},{default:d(()=>c[3]||(c[3]=[T("帳號隱私")])),_:1}),o(ye,{modelValue:h(e).user.isPublic,"onUpdate:modelValue":y,label:h(e).user.isPublic?"公開":"私人","right-label":"",color:"light-green"},null,8,["modelValue","label"]),o($,{header:""},{default:d(()=>c[4]||(c[4]=[T("目前訂閱")])),_:1}),q("div",we,[r.value&&h(n).targetUserList.length===0?(_(),w(_e,{key:0,color:"brown",size:"2em"})):F("",!0),!r.value&&h(n).targetUserList.length===0?(_(),Q("div",Te," 還沒有訂閱喔！ ")):F("",!0)]),(_(!0),Q(oe,null,ie(h(n).targetUserEmails,(v,V)=>(_(),w(Ce,{key:V,user:v,"onRemove:user":c[1]||(c[1]=f=>x(f))},null,8,["user"]))),128))]),_:1})]),o(pe,{modelValue:a.value,"onUpdate:modelValue":c[2]||(c[2]=v=>a.value=v)},{default:d(()=>[o(ge,null,{default:d(()=>[o(be,{class:"row items-center"},{default:d(()=>[q("div",$e,E(s.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Fe=L(Pe,[["__scopeId","data-v-32b7a487"]]);export{Fe as default};
