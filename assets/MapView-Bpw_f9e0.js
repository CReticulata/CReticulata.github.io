import{k as Q,m as w,N as R,n as b,o as C,q as _,C as x}from"./Note-ClK2G8ig.js";import{_ as W,V as E,r as c,w as M,q as P,L as z,Y as s,X as p,a0 as S,R as r,M as O,a1 as U,a2 as q,Z as A}from"./index-phaSoOGw.js";const H={__name:"MapView",setup(K){const t=E(),l=c({user:t.user.ID||"",id:"",storeName:"",foodScore:0,serviceScore:0,pros:"",cons:"",location:{lat:0,lng:0},googlemapURL:"",address:"",photos:[]}),y=c(""),u=c(!1),m=c(!1),f=c(!1);let i,d,g;async function L(){const a=t.userLocation,{Map:e}=await google.maps.importLibrary("maps"),{AdvancedMarkerElement:o}=await google.maps.importLibrary("marker");i=new e(document.getElementById("map"),{zoom:18,center:a,mapId:"DEMO_MAP_ID",gestureHandling:"greedy"}),new o({map:i,position:a,title:"目前位置"}),i.addListener("click",n=>{n.placeId&&B(n.placeId,i)})}async function B(a,e){const{Place:o}=await google.maps.importLibrary("places"),n=new o({id:a,requestedLanguage:"zh_Hant"});await n.fetchFields({fields:["formattedAddress","googleMapsURI","location","displayName"]}),N(a,n.displayName,{lat:n.location.lat(),lng:n.location.lng()},n.googleMapsURI,n.formattedAddress),I(n.location,e,n.displayName,n.formattedAddress)}async function I(a,e,o,n){const{InfoWindow:v}=await google.maps.importLibrary("maps");d=new v({position:a,content:D(o,n),maxWidth:250}),d.open(e),google.maps.event.addListener(d,"domready",function(){const V=document.querySelector(".create-note");V&&V.addEventListener("click",()=>{if(t.notes.find(k=>k.id===l.value.id)){m.value=!0,d.close();return}if(!t.user.ID){f.value=!0,d.close();return}u.value=!0})})}function D(a,e){return`
    <div class="info-window">
      <h6>${a}</h6>
      <p>${e}</p>
      <div class=info-window__button>
        <button class="create-note">新增筆記</button>
      </div>
    </div>`}L(),M(()=>t.userLocation,()=>{L(),g.setOptions({bounds:{north:t.userLocation.lat+.1,south:t.userLocation.lat-.1,east:t.userLocation.lng+.1,west:t.userLocation.lng-.1}})}),P(async()=>{const a=document.querySelector(".search-input input");await google.maps.importLibrary("places");const e={north:t.userLocation.lat+.1,south:t.userLocation.lat-.1,east:t.userLocation.lng+.1,west:t.userLocation.lng-.1};g=new google.maps.places.Autocomplete(a,{fields:["place_id","geometry","formatted_address","name","url"],bounds:e}),g.addListener("place_changed",()=>{d&&d.close();const o=g.getPlace();!o.geometry||!o.geometry.location||(o.geometry.viewport?i.fitBounds(o.geometry.viewport):(i.setCenter(o.geometry.location),i.setZoom(18)),N(o.place_id,o.name,{lat:o.geometry.location.lat(),lng:o.geometry.location.lng()},o.url,o.formatted_address),I(o.geometry.location,i,o.name,o.formatted_address))})});function h(a){d.close(),u.value=!1;const e=a;if(l.value={user:t.user.ID,id:"",storeName:"",foodScore:0,serviceScore:0,pros:"",cons:"",location:{lat:0,lng:0},googlemapURL:"",address:"",photos:[]},t.notes.find(o=>o.id===e.id)){m.value=!0;return}t.createNote(e)}function N(a,e,o,n,v){l.value.id=a,l.value.storeName=e,l.value.location=o,l.value.googlemapURL=n,l.value.address=v}return M(()=>t.user,()=>{l.value.user=t.user.ID}),(a,e)=>(O(),z("div",null,[s(Q,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),class:"search-input",outlined:"",placeholder:"在這裡搜尋",color:"red"},null,8,["modelValue"]),e[9]||(e[9]=p("div",{class:"separator row flex-center"},[p("div",{class:"text text-grey-7 q-py-sm"},"或直接點選地點")],-1)),p("div",{id:"map",onTouchstart:e[1]||(e[1]=S(()=>{},["stop"])),onMousedown:e[2]||(e[2]=S(()=>{},["stop"]))},null,32),s(w,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=o=>u.value=o),persistent:""},{default:r(()=>[s(R,{isCreate:!0,"onUpdate:isCreate":e[3]||(e[3]=o=>u.value=o),noteInput:l.value,"onCreate:note":h},null,8,["noteInput"])]),_:1},8,["modelValue"]),s(w,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o)},{default:r(()=>[s(b,null,{default:r(()=>[s(C,{class:"row items-center"},{default:r(()=>[s(U,{name:"warning",color:"negative",size:"24px"}),e[7]||(e[7]=p("span",{class:"q-ml-sm"},"已經寫過這家店的筆記囉！",-1))]),_:1}),s(_,{align:"right"},{default:r(()=>[q(s(A,{flat:"",label:"OK",color:"primary"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(w,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=o=>f.value=o)},{default:r(()=>[s(b,{style:{width:"200px"}},{default:r(()=>[s(C,{class:"row items-center"},{default:r(()=>[s(U,{name:"warning",color:"negative",size:"24px"}),e[8]||(e[8]=p("span",{class:"q-ml-sm"},"請先登入！",-1))]),_:1}),s(_,{align:"right"},{default:r(()=>[q(s(A,{flat:"",label:"OK",color:"primary"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},F=W(H,[["__scopeId","data-v-cbb65e42"]]);export{F as default};
